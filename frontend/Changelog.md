# Frontend Changelog

## WIP

- Fixed single player boss level progression bug: Game no longer switches to multiplayer mode after defeating tree boss
  - **Problem**: After beating boss level 3, game would advance to level 4 in offline mode, then incorrectly switch to level 5 in online mode
  - **Root Cause**: Double level increment bug - `startNextLevel()` method was calling `nextLevel()` AND the callback was also calling `nextLevel()`, causing level to jump from 4→5 and triggering multiplayer mode
  - **Solution**: Simplified `startNextLevel()` to only call the callback, preventing double increment and double scene restart
  - **Follow-up Fix**: Enhanced `GameScene.nextLevel()` to preserve offline state and selected sprite in scene restart parameters
  - **Victory Cheat Fix**: Fixed `triggerVictoryCheat()` to accept proper callbacks, preventing infinite loop and enabling "Start Next Level" button functionality
  - **Additional Fix**: Enhanced `shouldAutoRejoin()` to clear rejoin flags when in offline mode for extra safety
- Enhanced offline mode isolation: Single player mode now completely avoids backend synchronization calls
  - **Improvement**: Added additional guards to prevent network operations in offline mode
  - **Changes**: Enhanced `getGameState()` to return null roomData in offline mode, added guard to `setRejoinFlags()` method
  - **Benefits**: Single player mode is now fully isolated from network operations, improving performance and preventing potential errors
- Fixed room data flow to maintain NetworkSystem as single source of truth
  - **Problem**: GameScene was maintaining its own copy of room data, potentially causing synchronization issues
  - **Solution**: Removed local `roomData` property from GameScene, updated all references to use NetworkSystem.getCurrentRoomData()
  - **Changes**: Updated `sendReadyForWorldFromGameScene()` and room data initialization to use NetworkSystem directly
  - **Benefits**: Eliminates room data synchronization issues, ensures consistent room state across all components
- Fixed single player cheat system: UIScene level click cheat (5 clicks) now properly triggers victory by adding missing event listener in GameScene

- **Fixed Multiplayer Restart State Synchronization**: Fixed "Expected state ROOM_JOINED, got ConnectionState.GAME_READY" error during level restart
  - **Problem**: Game tried to send `ready_for_world` message before completing the rejoin process after restart
  - **Root Cause**: Networking setup happened immediately while auto-rejoin process was delayed, causing state mismatch
  - **Solution**: Delayed networking setup until after successful rejoin completion and proper state reset
- **Fixed NetworkSystem Missing Method Error**: Fixed `addPlatformCollisionForNetworkEnemies is not a function` error in multiplayer
  - **Problem**: Post-refactoring missing method causing crashes when setting up network enemy platform collisions
  - **Root Cause**: Enemy system refactoring centralized enemy management in EnemySystem, but NetworkSystem was missing the interface method
  - **Solution**: Added `addPlatformCollisionForNetworkEnemies()` and `getNetworkEnemies()` methods to NetworkSystem that delegate to EnemySystem
- **Fixed Multiplayer Victory Timing Bug**: Victory no longer triggers before enemies are loaded from server
  - **Problem**: Victory condition checked immediately after world setup, but enemies only arrive later from server
  - **Root Cause**: Network enemies stored separately from local enemies, but victory only counted local enemies
  - **Solution**: Added `isGameReady()` check and `countNetworkEnemies()` method to count both local and network enemies
  - **Changes**: 
    - Victory checks now wait for `ConnectionState.GAME_READY` in multiplayer mode
    - Victory logic counts both `EnemySystem.countActiveEnemies()` and `NetworkSystem.countNetworkEnemies()`
- **Fixed Network Enemy Animation Bug**: Network enemies now display proper animations instead of showing "Missing animation" errors
  - **Problem**: NetworkSystem used incorrect animation names (`owlet_idle_anim`) that didn't match existing animations
  - **Solution**: Updated animation mapping to match EnemySystem naming (owlet→adventurer_idle, slime→slime_idle, pink_boss→pink_enemy_idle_anim)
- **Fixed Multiplayer Restart Issues**: Restart now properly rejoins room without state mismatch errors
  - **Problem**: After restart, state mismatch errors ("Expected ROOM_JOINED, got GAME_READY"), missing join parameters, loading timeouts
  - **Solution**: Added NetworkSystem.resetState(), proper restart data with room parameters, and auto-rejoin trigger
  - **Changes**: Scene restart now preserves room name/username and triggers auto-rejoin after NetworkSystem state reset
- **Fixed Network Enemy Scaling Bug**: Network enemies now have the same size and appearance as local enemies
  - **Problem**: Network mini bosses were 10-12x larger than single player enemies (scale 1.0-1.2 vs 0.1)
  - **Solution**: Updated all network enemy types to use scale 0.1, depth 12, and bounce 1 to match local enemies
  - **Changes**: Consistent enemy appearance between single player and multiplayer modes
- **Refactored Enemy System Architecture**: Eliminated duplication between local and network enemy management
  - **Problem**: NetworkSystem and EnemySystem had completely separate, duplicated enemy creation and animation logic
  - **Solution**: Made EnemySystem the single source of truth for all enemy management (local + network)
  - **Changes**:
    - EnemySystem now handles both local and network enemies with centralized creation methods
    - NetworkSystem delegates enemy management to EnemySystem instead of duplicating logic
    - Consistent enemy type mapping, graphics, animations, and properties across all modes
    - Simplified victory condition logic (single count instead of separate local/network counts)
- **Cleaned Up Enemy Types**: Standardized to only use 2 enemy types consistently across frontend and backend
  - **Problem**: Inconsistent enemy types between frontend (adventurer/slime) and backend (owlet/pink_boss/slime)
  - **Solution**: Updated backend to use only 'adventurer' and 'slime', removed all historical type mappings
  - **Changes**: 
    - Backend now creates 'adventurer' and 'slime' enemies directly
    - Removed frontend type mapping (owlet→adventurer, pink_boss→adventurer)
    - Removed old unused updateNetworkEnemies method with pink_boss references
    - Consistent enemy types across all systems: only 'adventurer' (boss) and 'slime' (regular)
- **Implemented State-Based Multiplayer Protocol**: Replaced timing-dependent protocol with explicit state transitions and acknowledgments
  - **Problem**: Previous protocol relied on message timing and could cause race conditions
  - **Solution**: Implemented state-based protocol with explicit acknowledgments at each step
  - **New Protocol Flow**:
    1. Client joins room → Server sends `room_joined` 
    2. Client sends `ready_for_world` → Server sends `world_state`
    3. Client sends `world_ready` → Server sends `game_state`
    4. Client sends `client_ready` → Initialization complete
  - **Changes**:
    - Added connection state tracking (`CONNECTED → ROOM_JOINED → WORLD_SENT → GAME_READY`)
    - Added acknowledgment message types: `ready_for_world`, `world_ready`, `client_ready`
    - Added state validation to prevent out-of-order message processing
    - Backend validates state transitions and rejects invalid requests
    - Frontend automatically sends acknowledgments at each step
  - **Result**: Eliminates timing dependencies and ensures reliable initialization order
    - Moved `setupNetworking()` call before `createGameSystems()` in GameScene
    - Ensures message handlers are registered before any messages arrive
  - **Result**: Frontend now receives world_state messages and can create synchronized world

- **Added Loading Screen for Online Mode**: Improved user experience while waiting for server synchronization
  - **Feature**: Added German loading screen "Welt wird mit dem Server synchronisiert..." with animated spinner
  - **Components**:
    - Semi-transparent overlay with loading text and animated dots
    - 10-second timeout with error handling and retry button
    - Proper cleanup when scene is destroyed
  - **User Experience**: Players now see clear feedback while waiting for world synchronization
  - **Error Handling**: Shows connection error with retry option if server doesn't respond

- **Enhanced Debug Logging**: Added comprehensive debugging to track message flow issues
  - **Problem**: Difficult to diagnose why world state messages weren't being received
  - **Solution**: Added detailed logging throughout the network flow
  - **Changes**:
    - Added logging to NetworkManager message handler registration
    - Added logging to NetworkSystem initialization and setup
    - Added logging to GameScene networking setup
    - Enhanced message flow tracking from backend to frontend
  - **Result**: Better visibility into network message handling and easier debugging

- **Fixed Critical PlatformState Naming Conflict**: Resolved backend error preventing world state from being sent
  - **Problem**: Backend was throwing `PlatformState.__init__() got an unexpected keyword argument 'moving_data'` error
  - **Root Cause**: Naming conflict between local `PlatformState` class and imported Pydantic `PlatformState` model
  - **Solution**: Renamed local class to `Platform` to avoid shadowing the imported Pydantic model
  - **Changes**:
    - Renamed `PlatformState` class to `Platform` in `backend/app/game/world.py`
    - Updated all references to use the new class name
    - Fixed `get_world_state()` method to properly create Pydantic `PlatformState` objects
  - **Result**: Backend can now successfully send world state messages to clients

- **Fixed World State Data Structure**: Resolved issue where backend was sending world state as plain dictionary instead of proper model
  - **Problem**: Backend `get_world_state()` returned plain dictionary, but frontend expected structured data
  - **Solution**: Updated backend to return proper `WorldStateData` model with `model_dump()` serialization
  - **Result**: World state messages now have correct structure and are properly received by frontend
  - **Changes**:
    - Updated `get_world_state()` to return `WorldStateData` model
    - Added proper imports for `WorldStateData` and `PlatformState`
    - Fixed websocket handler to use `model_dump()` for serialization
    - Restored accidentally removed `generate_moving_platforms()` method

- **Fixed World State Message Handling**: Resolved issue where world state messages weren't being properly forwarded
  - **Problem**: NetworkManager had duplicate world_state handler that conflicted with NetworkSystem's handler
  - **Solution**: Removed duplicate handler from NetworkManager, let NetworkSystem handle world_state messages
  - **Result**: World state messages now properly trigger world creation callback
  - **Changes**:
    - Removed duplicate world_state handler from NetworkManager
    - Added debug logging to track world state flow
    - Reduced game state update log verbosity (only log every 30th update)

- **Fixed World Creation Timing**: Resolved issue where client tried to create world before receiving server world state
  - **Problem**: Client was creating fallback world immediately when joining, instead of waiting for server world state
  - **Solution**: Modified world creation flow to wait for server world state before creating synchronized world
  - **Result**: Proper world synchronization and no duplicate world creation
  - **Changes**:
    - Split world creation into `createGameSystems()` and `setupSystemsForWorld()` methods
    - Added early return for online mode until server world state is received
    - Added checks to prevent system updates before world is created

- **Major Networking Fixes**: Completely overhauled multiplayer networking system
  - **World Synchronization**: Added server-side world generation to ensure all players see identical levels
    - Server now generates consistent world layouts using deterministic seeds
    - Clients receive world state and generate synchronized platforms/enemies
    - Eliminates issue where players saw completely different levels
  - **Player Position Fixes**: Resolved network player flickering and collision issues
    - Added proper physics body setup for network players
    - Implemented position interpolation to reduce micro-movements
    - Fixed collision detection between network players and platforms
  - **Enhanced Network System**: Improved overall multiplayer stability
    - Added world state message handling
    - Better error handling and fallback mechanisms
    - Improved authority resolution for shared game objects
  - **New WorldSynchronizer**: Created dedicated system for server-synchronized world generation
    - Replaces client-side random generation in online mode
    - Maintains offline mode with local WorldGenerator
    - Ensures consistent multiplayer experience

- **Fixed Server URL Change Reconnection**: Resolved issue where changing server URL didn't properly reconnect to new server
  - **Disconnect Before Reconnect**: Modified `attemptAutoConnection()` to disconnect from current server before connecting to new URL
  - **Debounced Input Handling**: Added 1-second debounce to server URL input to prevent rapid reconnection attempts while typing
  - **Proper Connection Flow**: NetworkManager now properly disconnects from old server and connects to new server when URL changes
  - **Timeout Cleanup**: Added proper cleanup of debounce timeout when scene is destroyed to prevent memory leaks
  - **Enhanced Logging**: Added detailed logging to track disconnect/reconnect process for better debugging
  - **Prevents Connection Spam**: Eliminates repeated "Already connected, skipping auto-connection" messages when URL changes
  - **Fixed URL Port Preservation**: Resolved issue where port numbers were lost during HTTP to WebSocket URL conversion
  - **Robust URL Parsing**: Replaced string replacement with URL constructor for proper URL parsing and component preservation
  - **Fallback Mechanism**: Added fallback to string replacement method if URL parsing fails for compatibility
  - **Enhanced Debug Logging**: Added detailed logging to track URL conversion process for better debugging
  - **Prevented URL Fallback**: Fixed issue where connection would revert to old/default URL after successful connection to new server
  - **Removed Auto-Reconnection**: Disabled NetworkManager's automatic reconnection to prevent falling back to wrong server URL
  - **Current URL Persistence**: Always save current URL to localStorage and use input field value instead of fallback URLs
  - **Clean URL Management**: Removed unused reconnection properties and methods from NetworkManager

- **Fixed Multiplayer Message Handler Conflicts**: Resolved "Unhandled message type: game_state" errors by eliminating conflicting message handlers between components
  - **Clear Separation of Responsibilities**: Removed conflicting handlers from NetworkManager and established clear message handling hierarchy
  - **NetworkManager Cleanup**: Removed default "room_joined" handler from NetworkManager to prevent conflicts with MenuScene and NetworkSystem
  - **MenuScene Handler**: MenuScene continues to handle "room_joined" messages for scene transitions and player ID management
  - **NetworkSystem Handler**: NetworkSystem now exclusively handles "game_state" messages for multiplayer synchronization
  - **Player ID Flow**: Player ID is now properly passed from MenuScene to GameScene to NetworkSystem without handler conflicts
  - **Enhanced Debugging**: Added detailed logging to track message handler registration and game state updates
  - **Build Verification**: Confirmed fix works in both development and production builds
  - **Prevention Strategy**: Documented clear message handling responsibilities to prevent future conflicts

- **Two-Stage Menu System**: Split the single long menu into two stages for better user experience and reduced menu height
  - **Stage 1 Menu**: Contains username input, character selection, and single/multiplayer choice buttons
  - **Stage 2 Menu**: Contains server URL input, connection status, and start multiplayer button (only shown when multiplayer is selected)
  - **Improved UX Flow**: Users first configure basic settings, then choose game mode - single player starts immediately, multiplayer shows connection options
  - **Connection Status Integration**: Real-time connection status display with visual feedback (connected/disconnected/connecting states)
  - **Smart Button States**: Start multiplayer button is disabled until connection is established
  - **Back Navigation**: Users can return to stage 1 from stage 2 using back button
  - **Preserved Functionality**: All existing features maintained including sprite selection, server URL persistence, and auto-connection
  - **Reduced Menu Height**: Each stage is now compact and fits better on smaller screens
  - **Enhanced Visual Design**: Stage 2 has smaller title and focused layout for connection management

- **Simplified Platform Generation**: Completely rewrote WorldGenerator to remove complex chunk-based system and simplify platform generation logic
  - **Removed Chunk System**: Eliminated complex chunk-based world streaming with multiple maps and sets
  - **Simplified Platform Generation**: Replaced multiple tier-based methods (low/mid/high) with single floating platform generation
  - **Streamlined Moving Platforms**: Simplified moving platform logic by storing movement data directly on platform objects
  - **Cleaner Boss Arena**: Simplified boss arena generation with straightforward exclusion zone approach
  - **Reduced Code Complexity**: Reduced file from 813 lines to 307 lines (62% reduction)
  - **Removed Excessive Logging**: Eliminated verbose debug logging that cluttered the code
  - **Consistent Platform Sizing**: Standardized platform dimensions and positioning logic
  - **Maintained Functionality**: All original features preserved while significantly improving maintainability
  - **Fixed Compilation Errors**: Removed calls to non-existent methods and fixed unused parameters
  - **Increased Platform Density**: Significantly increased platform count with focus on low, accessible platforms
    - **More Low Platforms**: 60% of platforms are now low platforms (500-650px) easily reachable by jumping
    - **Better Distribution**: 30% mid platforms (350-500px) and 10% high platforms (200-350px) for progression
    - **Increased Base Count**: Platform count increased from 15+level*2 to 25+level*3 for more density
    - **More Moving Platforms**: Increased moving platform count from 3+level to 5+level\*2 (max 12)
    - **Varied Moving Platform Heights**: Moving platforms now spawn at different heights for better accessibility
  - **Improved Moving Platforms**: Moving platforms now use proper tiled textures instead of single tiles
    - **Random Widths**: Moving platforms now have random widths (96-224px) like other platforms
    - **Proper Tiling**: Moving platforms use the same tiled texture system as static platforms
    - **Visual Consistency**: Moving platforms now look consistent with the rest of the world
    - **Better Collision**: Proper collision boxes that match the visual size of the platforms
    - **Complete Tile Rendering**: Fixed issue where only partial tiles were visible on moving platforms
    - **Proper Tile Movement**: All tiles in moving platforms now move together as a cohesive unit
    - **Relative Positioning**: Tiles maintain their relative positions to the platform center during movement
  - **Fixed Ground Platform Coverage**: Resolved issue where ground platforms didn't extend to the end of the level
    - **Correct World Width Calculation**: Fixed ground platform generation to account for LEFT_BOUNDARY (-2000px)
    - **Complete Ground Coverage**: Ground platforms now properly extend from -2000px to 12000px
    - **Level Completion Fix**: Players can now reach the end of the level without falling through gaps
    - **Boss Level Ground Fix**: Boss levels now use the same full ground coverage as normal levels
    - **Consistent Ground Generation**: Both normal and boss levels now use `generateGroundPlatforms()` for complete coverage
    - **Boss Elevated Platform**: Added back the elevated platform (400px wide) where the tree boss stands
    - **Complete Boss Arena**: Boss levels now have both full ground coverage and the boss's elevated platform

- **Fixed Boss Level Ground Floor**: Resolved missing ground floor in boss levels by simplifying ground creation approach
  - **Simplified Ground Creation**: Boss arena now creates ground platforms directly in main physics group using same dimensions as regular levels
  - **Consistent Ground Creation**: Boss arena uses same platform width (192px) and height (64px) as regular levels
  - **Proper Platform Segmentation**: Ground is created as multiple platform segments instead of single large platform
  - **Fixed Physics Body Creation**: Resolved issue where ground tiles weren't properly added to physics group by using correct tile creation method
  - **Enhanced Debug Logging**: Added detailed logging to track ground platform creation process
  - **Maintained Arena Size**: Boss arena still uses compact 400px width but with proper segmented ground platforms
  - **Fixed Collision Detection**: Restored proper platform collision detection for player and enemies by using correct physics group management

- **Enhanced Enemy AI**: Improved enemy behavior with smarter movement, jumping capabilities, and platform navigation
  - **Player Tracking**: Enemies now move towards the player with 70% probability when within 400px detection range
  - **Jumping Capability**: Enemies can jump with 30% probability when near platform edges, using 400px jump speed (similar to player)
  - **Platform Navigation**: Added edge detection system that allows enemies to jump onto platforms and navigate the world
  - **AI Update System**: Implemented periodic AI updates (every 500ms) with cooldown management for jump and direction changes
  - **Smart Movement**: Enemies prioritize moving towards player when detected, with fallback to random movement when player is out of range
  - **Cooldown Management**: Added jump cooldown (1.5s) and direction change cooldown (2s) to prevent erratic behavior
  - **Edge Detection**: Raycast system checks for platforms ahead and triggers jumping when enemies approach edges
  - **Animation Integration**: Jumping enemies play appropriate movement animations (run for adventurer, move for slime)
  - **Reference System**: Added player and platform references to EnemySystem for AI decision making
  - **Performance Optimization**: AI updates are throttled to prevent excessive calculations and maintain smooth gameplay

- **Fixed Level Display Bug**: Resolved issue where level heading showed "Level 3" instead of "BOSS LEVEL 3" for boss levels
  - **Timing Issue Resolution**: Fixed race condition where UI scene was created before level was properly initialized
  - **Game State Integration**: Modified `createLevelDisplay()` to get current level from game scene's GameStateManager
  - **Immediate Display Update**: Added call to `updateLevelDisplay()` after creating level text to ensure correct display from start
  - **Proper Boss Level Detection**: Level display now correctly shows "BOSS LEVEL X" for levels 3, 6, 9, etc. with red text color
  - **Enhanced Debug Logging**: Added console logs to track level display creation and updates for better debugging

- **Victory State Game Loop Pause**: Implemented proper game pause when victory is achieved to prevent player death and stop all movement
  - **Phaser Physics Pause**: Uses `this.scene.physics.pause()` to stop all physics-based movement when victory is triggered
  - **Simplified Implementation**: Replaced complex per-system pause logic with Phaser's built-in physics pause/resume functionality
  - **Automatic Resume**: Physics automatically resume when restarting game or moving to next level
  - **Prevents Post-Victory Death**: Player can no longer be killed after achieving victory since all movement stops
  - **Stops All Movement**: Enemies, projectiles, moving platforms, and player movement all stop when victory is achieved
  - **Clean Victory State**: Victory screen displays with frozen game state until player chooses to continue or return to menu

- **Boss Arena Platform Generation**: Generate random platforms that avoid boss collision box instead of removing colliding platforms
  - **Exclusion Zone Approach**: Simplified to use a large exclusion zone (5x boss size) around the boss instead of complex collision detection
  - **Boss Display Size Based**: Uses boss's actual display size (48x48 scaled by 7.5x) rather than collision bounds for simpler calculations
  - **Proactive Platform Placement**: Added `generateBossArenaPlatforms()` method that creates platforms in valid positions from the start
  - **Delayed Platform Generation**: Added frame delay to ensure boss physics body is fully initialized before calculating exclusion zone
  - **Platform Cleanup**: Added platform clearing at start of boss arena creation to ensure clean slate
  - **Simplified Logic**: Removed complex AABB collision detection in favor of simple exclusion zone checking
  - **Arena Boundary Calculation**: Dynamically calculates platform placement areas outside the exclusion zone
  - **Fallback Positioning**: If exclusion zone is too large, uses areas above and below the boss for platform placement
  - **Random Platform Generation**: Creates 3-5 random platforms with varying widths (80-200px) positioned outside exclusion zone
  - **Reduced Debug Spam**: Limited platform listing to first 10 platforms to avoid console overflow
  - **Clean Arena Layout**: Ensures boss arena has proper ground platform and random floating platforms without any collision issues
  - **Fixed World Streaming in Boss Levels**: Prevented normal chunk generation from running in boss levels by adding early return in `updateWorldStreaming()`

- **Menu Button Labels**: Changed button labels from "Online Spielen" and "Offline Spielen" to "Mehrspielermodus" and "Einzelspielermodus" for better German localization

- **Boss Level Frequency**: Changed boss levels from every 5th level to every 3rd level for more frequent boss encounters
  - **Updated GameStateManager**: Changed `isBossLevel()` method from `currentLevel % 5 === 0` to `currentLevel % 3 === 0`
  - **Updated WorldGenerator**: Changed boss level detection from `currentLevel % 5 === 0` to `currentLevel % 3 === 0`
  - **Updated UIScene**: Changed boss level display logic from `currentLevel % 5 === 0` to `currentLevel % 3 === 0`
  - **More Frequent Boss Fights**: Players now encounter tree boss at levels 3, 6, 9, 12, 15, etc. instead of 5, 10, 15, 20, 25, etc.
  - **Enhanced Game Progression**: More regular boss encounters provide better pacing and challenge distribution

- **Compact Boss Arena Design**: Redesigned boss levels as small, focused fighting areas around the boss
  - **Reduced Arena Size**: Ground platform reduced from 800px to 400px width for compact combat area
  - **Closer Platform Positioning**: Platforms now positioned close to boss for quick access and movement
  - **Simplified Layout**: Removed moving platforms and exit platform for focused boss combat
  - **Minimal Platform Count**: Only 3 small platforms (left, right, high) for essential movement options
  - **Boss-Focused Combat**: Arena designed to keep players close to boss for intense, focused battles
  - **No Walking Required**: Players can reach all areas quickly without long traversal distances
  - **Compact Ground**: Arena ground reduced from centerX±400 to centerX±200 for tighter combat space

- **Fixed Boss Death Bug**: Resolved issue where tree boss would become non-interactive without disappearing
  - **Added Boss enemyId**: Set `enemyId: "tree_boss"` for proper death state tracking
  - **Implemented Boss Death Animation**: Added fade-out animation for tree boss death with proper cleanup
  - **Enhanced Death Handling**: Added explicit group removal to ensure boss is properly destroyed
  - **Improved Victory Detection**: Created `isBossDefeated()` method for accurate boss defeat checking
  - **Fixed Level Completion**: Boss levels now properly complete when tree boss is defeated
  - **Added Debug Logging**: Console logs track boss death process for easier debugging

- **Boss Arena Platform Repositioning**: Moved platforms further from boss to prevent stone throwing interference
  - **Left Platform**: Moved from centerX-150 to centerX-250 to provide clear stone trajectory path
  - **Right Platform**: Moved from centerX+50 to centerX+150 to avoid blocking boss projectiles
  - **High Platform**: Moved from centerX-50 to centerX+200 to prevent interference with upward stone arcs
  - **Clear Shooting Lanes**: All platforms now positioned to allow boss stones to travel without obstruction
  - **Maintained Accessibility**: Platforms still accessible for player movement while avoiding boss interference

- **Tree Boss Collision Box Optimization**: Adjusted hit zone to match actual tree sprite shape
  - **Reduced Collision Width**: Set to 60% of sprite width to focus on main trunk area
  - **Reduced Collision Height**: Set to 80% of sprite height, excluding top branch areas
  - **Centered Collision Box**: Properly offset to align with tree trunk center
  - **Accurate Hit Detection**: Players must now aim at the actual tree trunk, not empty space
  - **Improved Gameplay Balance**: Makes boss fights more challenging and realistic
  - **Visual Alignment**: Collision bounds now match the visible tree sprite shape
  - **Debug Visualization**: Added red collision box display for visual debugging and testing
  - **Fixed Collision Box Display**: Added `updateBounds()` call to ensure collision box properly updates and displays correctly
  - **Conditional Debug Display**: Collision box debug display is hidden by default and only shows when level skip cheat is activated
  - **Code Refactoring**: Moved debug display logic into separate `createBossDebugDisplay()` method for better code organization

- **Boss Level Improvements**: Enhanced tree boss arena and stone throwing mechanics
  - **Fixed Boss Physics**: Resolved tree boss falling through ground by creating it as separate sprite with explicit physics control
  - **Enhanced Immobility**: Added `body.moves = false` and `body.allowGravity = false` to completely prevent boss movement
  - **Fixed Boss Positioning**: Corrected tree boss placement to sit properly on top of ground platform instead of below it
  - **Improved Ground Anchoring**: Set boss origin to bottom center (0.5, 1.0) for proper ground alignment
  - **Reduced Platform Obstacles**: Removed middle climbing platforms on both sides to give tree boss better shooting angles
  - **Simplified Moving Platforms**: Reduced from 2 to 1 moving platform to minimize blocking of boss projectiles
  - **Enhanced Stone Throwing**: Improved projectile mechanics with higher spawn position and more dramatic arc
    - **Higher Stone Spawn**: Stones now appear at 60% up the boss height instead of 30% for more dramatic launch
    - **Increased Arc Height**: Boosted projectile speed from 400 to 450 and reduced gravity from 800 to 600 for higher trajectories
    - **More Upward Velocity**: Increased initial upward velocity from -200 to -300 for steeper launch angles
    - **Better Visual Impact**: Stones now have more impressive high-arc trajectories that are harder to dodge
  - **Improved Player Targeting**: Stones use enhanced projectile motion formula to always target player position with dramatic upward arc
  - **Enhanced Arc Physics**: Implemented realistic projectile motion with optimized gravity effects for more challenging boss fights
  - **Upward Launch**: Stones now launch upward first before arcing toward player, creating more interesting and challenging trajectories

- **Menu Animation Consolidation**: Replaced hybrid Phaser/HTML menu with pure HTML/CSS/JS approach
  - **CSS Sprite Animations**: Implemented pure CSS sprite sheet animations for character previews using `background-position` and `@keyframes`
  - **Frame-by-Frame Animation**: Fixed sprite animations to use `steps(4, jump-none)` for proper frame-by-frame stepping without interpolation
  - **Enhanced Button Animations**: Added ripple effects, hover animations, and smooth transitions for all menu buttons
  - **Input Field Enhancements**: Added focus animations with gradient underlines and subtle lift effects
  - **Sprite Selection System**: Character selection now uses CSS animations instead of Phaser sprites for better performance
  - **Simplified MenuScene**: Removed complex Phaser sprite positioning code and character preview creation methods
  - **Pure HTML Approach**: Menu now uses classical HTML/CSS/JS without mixed Phaser/HTML rendering
  - **Animation Visibility Fixed**: Sprite animations are now clearly visible and properly animated in the menu
  - **Performance Improvement**: Reduced Phaser overhead by using native CSS animations for menu elements
  - **Enhanced UX**: Added click ripple effects, improved hover states, and better visual feedback for all interactions

- Replaced all enemy sprites with new animation systems:
  - **Normal Enemies**: Replaced Owlet Monster with SLIME sprites featuring full animation set (idle, move, attack, hurt, death)
  - **Small Boss Enemies**: Replaced Pink Monster with ADVENTURER sprites featuring combat animations (idle, run, slash, hurt, death)
  - **Sprite Source**: Copied 47 ADVENTURER frames and 42 SLIME frames from `tiles/free_rpg_sprites/` to frontend assets
  - **State-based Animation System**: Added comprehensive enemy state tracking (idle, running, attacking, hurt, dying)
  - **Combat Animations**: Enemies play attack animation when hitting player, hurt animation when taking damage
  - **Death Sequences**: Full death animation plays before enemy removal (1000ms for ADVENTURER, 750ms for SLIME)
  - **Smart Sprite Flipping**: Sprites auto-flip based on movement direction (both ADVENTURER and SLIME are right-facing by default, flip when moving left)
  - **Animation Performance**: Optimized frame rates (ADVENTURER slash: 15fps, SLIME attack: 12fps, movement: 8fps)
  - **Uniform Enemy Scaling**: Scaled down both SLIME and ADVENTURER sprites to 0.1 scale for consistent player-sized enemies
  - **Complete Sprite Optimization**: Batch-trimmed transparent padding from all 89 enemy sprites using ImageMagick
    - **SLIME sprites**: 42 frames optimized, 21% file size reduction (1.4MB → 1.1MB)
    - **ADVENTURER sprites**: 47 frames optimized, 7% file size reduction (5.6MB → 5.2MB)
    - **Benefits**: Eliminated floating appearance, improved collision detection, reduced asset loading time
  - **Sprite Orientation Fix**: Corrected ADVENTURER sprite flipping logic to match natural right-facing orientation
  - **Network Compatibility**: Updated multiplayer enemy synchronization with color-coded tints (purple ADVENTURER, green SLIME)
  - **Dead Enemy Behavior Fix**: Dead/dying enemies now properly stop moving and cannot hurt players
    - **Movement Prevention**: Dying enemies skip AI updates in `updateEnemies()` method to remain stationary during death animation
    - **Physics Interaction Disabled**: Dead enemies have bouncing disabled (`setBounce(0)`) and become immovable to prevent post-death physics interactions
    - **Collision Handler Fix**: `handlePlayerEnemyHit()` now checks enemy state before applying damage, preventing dead enemies from hurting players
    - **Damage Prevention**: Dead enemies cannot trigger `enemyHitPlayer()` method to prevent posthumous damage to players
      - **Network Synchronization**: Network enemies with health <= 0 are handled correctly with death animations and no movement
    - **State Management**: Proper "dying" state tracking prevents dead enemies from affecting gameplay
    - **Legacy Preservation**: Kept original Owlet and Pink Monster sprites in assets for future alternative player characters
    - **Asset Loading**: Enhanced AssetLoader with individual frame loading for smooth animation transitions
- **Player Character Selection System**: Complete implementation of selectable player sprites
  - **Menu Interface**: Added animated sprite selection UI with three character options (Held/Dude, Eule/Owlet, Rosa/Pink)
  - **Animated Character Previews**: Replaced static sprite images with fully animated Phaser sprites showing each character's idle animation in real-time
  - **Visual Design**: Implemented hover animations, selection indicators, and live sprite previews with continuous character animations
  - **Persistence**: Player sprite selection saved to localStorage and restored on menu load
  - **Dynamic Asset Loading**: Updated AssetLoader to load all three player sprite variants (dude_monster, owlet_monster, pink_monster)
  - **PlayerSystem Integration**: Modified PlayerSystem constructor to accept dynamic sprite types and update all animations accordingly
  - **Game Flow Integration**: Pass selected sprite from MenuScene through GameScene to PlayerSystem initialization
  - **State Preservation**: Updated GameStateManager to preserve sprite selection across level transitions and game restarts
  - **Network Compatibility**: Updated NetworkSystem to handle different sprite types (defaults to dude_monster for network players)
  - **Animation System**: Dynamic animation keys based on sprite type (e.g., "dude_monster_idle_anim", "owlet_monster_run_anim")
  - **Restart Preservation**: All restart scenarios (offline/online, level transitions, connection loss) maintain selected sprite
- Replaced player projectiles with animated fireball sprites:
  - Copied blue fireball keyframe images from `tiles/fireballoga/blue/keyframes/` to frontend assets
  - Updated AssetLoader to load 6 fireball animation frames and create left/right facing animations
  - Replaced simple white pixel projectile texture with fully animated fireball sprites in PhysicsSystem
  - Added proper direction handling with animation mirroring (setFlipX) for right-facing shots
  - Scaled fireball projectiles to 10% size (0.1 scale) for optimal visibility while remaining bullet-like
  - Added more upward trajectory to projectiles (increased vertical velocity from -50 to -120) for better shooting arc
  - Applied fireball animations to both local and network multiplayer projectiles with red tint for remote players
  - Fireball animations run at 12 FPS for smooth flame effect while maintaining performance
- Enhanced platform generation for better accessibility:
  - Completely redesigned floating platform system with tiered architecture for progressive climbing
  - Added low-tier platforms (y=570-620) easily reachable from ground level with single jump
  - Added mid-tier platforms (y=450-520) accessible from low-tier platforms for intermediate climbing
  - Added high-tier platforms (y=320-400) for advanced traversal and exploration rewards
  - Increased platform density from 3-6 to 5-7 platforms per chunk for better navigation options
  - Improved platform spacing and overlap prevention with better collision detection algorithms
  - Added moving platforms to normal levels (40% spawn chance, 1-2 per chunk)
  - Moving platforms operate at three different height ranges (low/mid/high tiers) with up/down movement
  - Moving platforms use physics-based movement system for smooth vertical traversal challenges
  - Enhanced platform validation to prevent overlapping and ensure adequate spacing between all platform types
- Fixed boss implementation issues:
  - Fixed tree boss falling through ground by adding proper gravity control and collision bounds
  - Fixed flickering up/down floating platforms by replacing tweens with physics-based movement system
  - Tree boss now properly anchors to ground level with `setGravityY(0)` and `setCollideWorldBounds(true)`
  - Moving platforms now use velocity-based movement with boundary detection instead of conflicting tweens
  - Platforms smoothly move between min/max Y positions using `setVelocityY()` and direction reversal logic
- Fixed moving platforms falling through bottom:
  - Converted moving platform physics from conflicting dynamic/immovable setup to proper kinematic bodies
  - Platforms now use `body.moves = true` with `body.setImmovable(true)` for correct physics behavior
  - Removed contradictory physics settings that caused platforms to fall through world boundaries
  - Moving platforms now properly respect gravity disable and maintain controlled vertical movement
  - Reduced debug logging in updateMovingPlatforms to prevent console spam during normal operation
  - Boss remains immovable by other objects while properly handling world collision boundaries
  - Fixed moving platforms falling down instead of moving up/down by properly configuring physics group settings
  - Added `allowGravity: false` to moving platforms group configuration to prevent world gravity interference
  - Fixed velocity setting to use `platform.body.setVelocityY()` instead of `platform.setVelocityY()` for proper physics integration
- Added victory music functionality:
  - Integrated "Viktor Kraus - Victory!.mp3" as dedicated victory music
  - Victory music automatically plays when level completion is achieved, replacing background music
  - Background music seamlessly restores when advancing to next level
  - Victory music respects user audio settings and global mute status
  - Proper audio cleanup prevents memory leaks during scene transitions
  - Enhanced audio control system with dedicated methods for victory/background music switching
- Added victory cheat functionality:
  - Level indicator (center-top of screen) is now clickable with hover effect
  - Clicking the level indicator 5 times in a row within 2 seconds triggers instant level completion
  - Cheat includes visual feedback: level text scales on each click and shows green tint when activated
  - Cheat properly integrates with existing victory system and level progression
  - Click counter resets after 2 seconds of inactivity for security
  - Fixed level completion flag reset in init() method for proper level transitions and cheat reusability
  - Prevents multiple cheat activations within the same level instance
- Added visual documentation with Mermaid diagrams:
  - Boss Arena System Flow diagram showing tree boss mechanics and platform navigation
  - Level Progression Fix Flow diagram documenting the corrected advancement logic
  - Audio System Management Flow diagram showing music switching between background/victory
  - Game Architecture Overview diagram displaying modular system design
  - All diagrams saved in notes with usage instructions for future reference
- Added background music support:
  - Added "Run Game 2.mp3" as looping background music in GameScene
  - Integrated audio loading through AssetLoader system with new `loadAudioAssets()` method
  - Background music respects audio toggle settings from UI (localStorage preference)
  - Implemented real-time audio control with mute/unmute event listeners
  - Music automatically pauses/resumes when audio is toggled during gameplay
  - Proper cleanup on scene restart and shutdown to prevent memory leaks
  - Volume set to 30% for comfortable gameplay experience
- Implemented comprehensive level progression system:
  - Added level completion detection when player reaches the end of the world (200px before right boundary)
  - Created level state management in `GameStateManager` with level tracking and progression
  - Enhanced victory UI to show "Level X Complete!" message with next level button
  - Added level number display at the top center of the screen like "Level 1"
  - Implemented enemy scaling system where higher levels spawn more enemies (1-2 base, +1 every 2 levels, cap at 6)
  - Added boss enemy probability scaling (10% base, +5% per level, cap at 40% boss chance)
  - Level state persists through scene restarts and multiplayer transitions
  - Victory screen shows "Continue to Level X" button for smooth progression
  - Anti-bounce mechanism prevents multiple level completion triggers
  - Level information is passed between scenes and synchronized with UI
- Implemented Boss Arena system for dedicated boss fights:
  - Boss levels trigger every 5th level (5, 10, 15, etc.) with special arena generation
  - Created massive Tree Boss using winter_tree.png sprite scaled to half screen height (300 HP)
  - Tree boss remains stationary and throws stone projectiles at player using stone.png graphics
  - Boss stones deal 15 damage with physics-based trajectory targeting and bouncing
  - Designed special arena layout with climbing platforms on both sides for vertical navigation
  - Added moving platforms with up/down tween animations for dynamic traversal challenges
  - Boss arena features wide central ground, side climbing stairs, and exit platform
  - Boss levels only complete when boss is defeated (not by reaching world end)
  - UI displays "BOSS LEVEL X" in red text to distinguish from regular levels
  - Stone projectiles have collision with player, platforms, and moving platforms
  - Enhanced collision system supports moving platforms and boss stone mechanics
- Simplified background rendering for better performance:
  - Removed complex perspective tree layers from WorldGenerator
  - Background image now provides sufficient visual depth without additional complexity
  - Removed unused `winter_tree` and `tree` assets from AssetLoader
  - Cleaned up excessive debug console logs for chunk generation and world streaming
  - Updated player depth comments to reflect simplified background system
  - Reduced bundle size and improved game experience by removing unnecessary complexity
- Implemented multiplayer score system:
  - Changed score reward from 100 to 10 points per enemy defeated
  - Added score tracking to player state for network synchronization
  - Added multiplayer score display showing other players' scores in real-time
  - Extended UI to show both current player score and other players' scores
  - Score is now synchronized across all players in multiplayer games
  - Fixed offline mode score display not showing initial score of 0
  - Removed conflicting event listeners that prevented proper score updates
  - Added comprehensive debug logging for score system troubleshooting
  - Fixed TypeScript compilation errors in UIScene.ts and main.ts for production builds
  - Added setScrollFactor(0) to all UI elements to prevent camera scrolling issues
  - Implemented proper depth layering for UI element visibility
- Changed server URL configuration from environment variables to UI input:
  - Added server URL input field to menu form with default value `https://server.tannenbaumbiel.echsecutables.de/`
  - Server URL is now saved in localStorage for persistence
  - Removed dependency on `VITE_WS_URL` environment variable
  - Connection is initiated when user clicks "Online Spielen" instead of on application startup
  - Automatic conversion from HTTP/HTTPS URLs to WS/WSS protocols
  - Updated Dockerfile to remove unused `VITE_WS_URL` build argument
  - Updated both docker-compose.yml and docker-compose.prod.yml to remove `VITE_WS_URL` references
- Added fullscreen landscape mode support for mobile devices:
  - Automatic fullscreen mode activation on mobile devices after game loads
  - Cross-browser fullscreen API support (WebKit, standard, MS implementations)
  - Screen orientation lock to landscape mode when supported by device
  - Fullscreen button for manual control with auto-hide in fullscreen mode
  - Updated game resolution from 1024x768 to 1280x720 for optimal landscape aspect ratio
  - Enhanced game scale configuration with expandParent and fullscreenTarget options
  - Responsive CSS with fullscreen-optimized styles and dynamic viewport handling
  - Portrait mode warning message encouraging users to rotate their device
  - Enhanced mobile meta tags for web app capabilities and better mobile experience
  - Smooth orientation change handling with automatic game scale refresh
- Fixed mobile touch controls not working:
  - Mobile buttons were being covered by UIScene elements (Menu button, audio toggle)
  - Added proper depth management (depth 1000) to ensure mobile buttons appear above other UI elements
  - Repositioned mobile buttons to avoid conflicts with existing UI elements
  - Improved button visual feedback with white borders and bold text labels
  - Made buttons slightly smaller (120x120) and more opaque (0.4 alpha) for better visibility
  - Added mobile device detection and automatic show/hide functionality
  - Mobile controls now automatically hide on desktop and show only on mobile devices
  - Added comprehensive touch event debugging and improved viewport settings for mobile
  - Added both pointer and touch event handlers for better mobile compatibility
  - Improved interactive settings with pixelPerfect: false and alphaTolerance: 1
  - Fixed mobile input flow: Connected ControlsSystem to PlayerSystem to ensure mobile touch events reach player movement
  - Unified input handling across online/offline modes - both now use the same ControlsSystem input path
- Consolidated input system: Removed dead code and debugging logs, cleaned up PlayerSystem mobile input handling
- Fixed TypeScript compilation errors: Added esModuleInterop, allowSyntheticDefaultImports, and downlevelIteration to tsconfig.json
- Removed redundant mobile input methods and excessive debug logging from both ControlsSystem and PlayerSystem
- Fixed WebSocket Content Security Policy violation in production:
  - Auto-upgrade WebSocket URLs from `ws://` to `wss://` when page is served over HTTPS
  - Updated nginx CSP header to include `connect-src 'self' ws: wss: http: https:` directive
  - Fixed menu form HTML structure to prevent CSP meta tag injection outside document head
  - Moved menu-form.html from src/ to public/ directory for proper static asset serving
  - Moved all game assets from src/assets/ to public/assets/ for production build inclusion
  - Updated AssetLoader.ts paths to use /assets/ instead of /src/assets/
  - Updated nginx configuration to serve .html files and updated all asset path references
  - Resolves browser blocking of insecure WebSocket connections on HTTPS sites
- Fixed Docker production build to properly handle Vite environment variables (`VITE_API_URL`, `VITE_WS_URL`) at build time
- Added comprehensive error handling for WebSocket connection failures
- Added user-visible error messages when server connection fails
- Added real-time connection status indicator in menu form with "connecting", "connected", and "disconnected" states
- Improved NetworkManager with connection timeout handling and better error messages
- Added detailed logging for debugging WebSocket connection issues
- Fixed TypeScript compilation errors:
  - Fixed variable scope issue with `serverUrl` in main.ts catch block
  - Fixed error type handling in NetworkManager.ts catch block (unknown type safety)
- Fixed offline game functionality:
  - Separated network initialization from game startup to prevent network failures from blocking game
  - Added comprehensive error handling and logging for debugging game initialization issues
  - Simplified menu system: "Online Spielen" button is now hidden when server is unavailable
  - "Offline Spielen" button remains always visible for offline gameplay
  - Improved startOfflineGame to pass proper initialization parameters
  - Removed complex fallback menu system in favor of simpler hide/show button logic
  - Cleaned up index.html: removed connection-status element and CSS (now only in menu form)
  - Simplified NetworkManager connection status handling (no longer updates index.html)

- **Fixed Docker build failure**: Complete TypeScript compilation and Docker configuration fixes
  - Removed `--only=production` flag from npm ci to include devDependencies needed for TypeScript/Vite build
  - Generated missing `package-lock.json` file required by npm ci
  - Fixed 24+ TypeScript compilation errors:
    - Added null checking for `scene.input.keyboard` access across Player.ts, ControlsSystem.ts, PlayerSystem.ts
    - Removed unused variable declarations across all system files
    - Fixed Phaser callback type mismatches with proper `ArcadePhysicsCallback` types
    - Fixed ImportMeta.env access with type assertion
    - Updated property type declarations to allow undefined keyboard inputs
  - Fixed Docker nginx user creation conflict with existing nginx group
- **MAJOR REFACTORING**: Extracted GameScene.ts into modular system architecture
  - **9 New System Modules**: Created focused, single-responsibility systems
    - `AssetLoader.ts` - Asset loading and management
    - `PlayerSystem.ts` - Player creation, movement, and state management
    - `EnemySystem.ts` - Enemy management and AI
    - `WorldGenerator.ts` - Procedural world generation and streaming
    - `NetworkSystem.ts` - Multiplayer networking and state synchronization
    - `CameraSystem.ts` - Side-scrolling camera management
    - `ControlsSystem.ts` - Input and touch controls
    - `PhysicsSystem.ts` - Collision detection and physics management
    - `GameStateManager.ts` - Game over, victory, restart, and level progression
  - **83% Code Reduction**: Reduced main scene from 1583 lines to ~280 lines
  - **Improved Maintainability**: Clear separation of concerns with single-responsibility systems
  - **Better Testability**: Each system can be tested independently
  - **Enhanced Reusability**: Systems can be reused across different scenes
  - **Future Extensibility**: Easy to add new systems or extend existing ones
  - **Dead Code Removal**: Deleted original GameScene.ts (1583 lines) and seamlessly replaced with modular architecture
  - **All Functionality Preserved**: No loss of features during refactoring, all existing scene references continue to work

- **MAJOR ENHANCEMENT**: Fixed and perfected parallax depth system
  - **Correct Parallax Hierarchy**: Fixed scroll factors for realistic depth perception
    - Background (furthest): 0.1 scroll factor - slowest movement
    - Far trees: 0.2 scroll factor
    - Mid trees: 0.4 scroll factor
    - Near trees: 0.7 scroll factor
    - Gameplay elements: 1.0 scroll factor - normal speed
  - **Accurate Tree Positioning**: Trees now positioned within background tree band (145-190px scaled to screen)
  - **Realistic Tree Scaling**: Near trees scaled much larger (1.0x-1.8x) for proper perspective depth
  - **Depth Layering Fix**: Changed tree depths from negative (-10) to positive (1-3) so trees appear in front of background
  - **Proper Z-Order**: Background=0, Trees=1-3, Player=10, Enemies=12, Projectiles=15

- **VISUAL ENHANCEMENT**: Enhanced parallax background system with multi-layer depth simulation
  - **Seamless Background Tiling**: Fixed horizontal background gaps with pixel-perfect integer positioning
  - **3-Layer Parallax Trees**: Implemented realistic depth simulation using both `winter_tree` and `tree` assets
    - **Far background** (scroll factor 0.2): Medium-sized trees with slight fade for distance effect
    - **Mid background** (scroll factor 0.5): Larger trees with moderate parallax scrolling
    - **Near background** (scroll factor 0.8): Large, full-opacity trees close to player
  - **Distance-Based Scaling**: Tree size varies with simulated distance (0.3x to 0.8x scale)
  - **Depth-Based Alpha**: Trees fade slightly with distance for atmospheric perspective (0.7 to 1.0 alpha)
  - **Proper Z-Layering**: Positive depth values ensure correct layering order
  - **Varied Tree Distribution**: Random selection between winter and regular trees for visual variety

- **BUG FIX**: Synchronized winter ground tiles between source and assets directories
  - Copied updated 32x32 pixel `winter_ground_upper_right.png` from `tiles/winter/` to `frontend/src/assets/winter/`
  - Synchronized all winter ground tile variants to ensure consistency
  - Fixed issue where game was using outdated tile assets instead of corrected versions

- **ENHANCEMENT**: Winter-themed world graphics implementation with intelligent tiling system
  - Replaced programmatically generated graphics with beautiful winter sprites from `Season_collection.png`
  - Updated to new winter background image `winter_bg.png` (288x208) with optimized scaling:
    - **Vertical scaling**: Background scales to fit full screen height exactly
    - **Horizontal tiling**: Background repeats seamlessly across world width
    - **Parallax effect**: 0.5x scroll factor for depth perception
  - Implemented intelligent winter ground tiling system using properly extracted 32x32 tiles:
    - `winter_ground_upper_left/middle/right.png` - For platform top edges with proper corners
    - `winter_ground_inner.png` - For platform interior areas
    - `winter_ground_lower_left/middle/right.png` - For platform bottom edges
  - Created `createWinterTiledPlatform()` method for seamless multi-tile platform construction
  - Updated ground platforms: 192px wide (6 tiles) × 64px high (2 tiles) for substantial terrain
  - Updated floating platforms: Variable width (96-192px, 3-6 tiles) × 32px high (1 tile) for variety
  - Added snowy winter trees (`tree.png`, `winter_tree.png`) for background decoration elements
  - Enhanced visual depth with proper parallax scrolling factors and authentic tile-based aesthetics

- **BUG FIX**: Fixed Game Over and Victory messages positioning
  - Game Over and Victory screens now always appear in center of visible screen area
  - Messages are positioned relative to camera center instead of fixed screen coordinates
  - Added `setScrollFactor(0)` to prevent UI elements from scrolling with camera
  - Fixed issue where messages could appear off-screen when world was scrolled

- **BUG FIX**: Fixed health and score display system
  - Health bar now updates when player takes damage from enemies
  - Score counter now increments when enemies are defeated
  - Added `health-changed` and `enemy-defeated` event emission in GameScene
  - UI components now receive proper event notifications for real-time updates

- **BUG FIX**: Fixed empty world on game restart
  - Added proper state reset in `init()` method to clear all world generation maps
  - Reset `chunksGenerated`, `visibleChunks`, `platformChunks`, and `backgroundElements` on restart
  - Reset multiplayer state variables to prevent state corruption
  - Ensured reliable world regeneration after game restart or level transition

- **MAJOR FEATURE**: Implemented complete side-scrolling system with procedural level generation
  - **Side-scrolling Camera**: Camera follows player with dead zone, world moves around player
  - **Extended World Bounds**: World extends from -2000 to 12000 pixels for infinite scrolling
  - **Procedural Generation**: Levels are generated in chunks as player explores
  - **Chunk-based System**: 1024px chunks with platforms, enemies, and background elements
  - **World Streaming**: Dynamic loading/unloading of chunks for memory efficiency
  - **Parallax Background**: Scrolling background with depth effect (0.5x scroll factor)
  - **Random Platform Generation**: Ground platforms and floating platforms in each chunk
  - **Procedural Enemies**: 1-3 randomly placed enemies per chunk (owlet/pink boss)
  - **Background Decorations**: Random trees with parallax scrolling (0.8x scroll factor)
  - **Memory Management**: Distant chunks are automatically unloaded to save resources
  - **Multiplayer Compatible**: Each player maintains their own camera view in multiplayer

- **BUG FIX**: Fixed "this.enemies is undefined" error in offline mode
  - Fixed initialization order issue where world generation tried to access enemy groups before they were created
  - Moved enemy and projectile group initialization to create() method before world generation
  - Offline mode now loads correctly without errors

- **MOBILE CONTROLS FIX**: Fixed mobile buttons broken by side-scrolling system
  - **Camera-Fixed UI**: Mobile buttons now stay fixed to camera with `setScrollFactor(0)`
  - **Input System**: Added proper `setPlayerInput()` method and mobile input state tracking
  - **Touch Integration**: Mobile touch inputs now work alongside keyboard and mouse inputs
  - **Better UX**: Added `pointerout` events to stop movement when finger leaves button
  - **Multiplayer Support**: Mobile inputs are properly synchronized in multiplayer mode

- **OFFLINE MODE FIX**: Fixed offline mode preservation during game restart and level transitions
  - Fixed issue where offline games would switch to online mode when restarting
  - Fixed issue where "next level" would return to menu instead of continuing in same mode
  - Modified `restartMultiplayerGame()` to preserve offline state when restarting
  - Added `startNextLevel()` method to handle level transitions while preserving game mode
  - Offline games now stay offline, online games stay online during all transitions
  - Added "Zurück zum Menü" option in victory screen for explicit menu return

- **CRITICAL BUG FIX**: Fixed "Field required" validation error during auto-rejoin after restart
  - Fixed issue where auto-rejoin was using server response data instead of original join parameters
  - Server was receiving only `{'character_type': 'hero1'}` instead of required `room_name` and `username`
  - Modified MenuScene to pass original join parameters (`originalRoomName`, `originalUsername`) to GameScene
  - Updated auto-rejoin logic to use stored original parameters instead of server response data
  - Added parameter validation and fallback defaults for rejoin process
  - Auto-rejoin after restart now works correctly with proper field validation

- **MAJOR MULTIPLAYER FIX**: Implemented proper game restart synchronization for multiplayer sessions
  - Fixed issue where only one player could see the other after restart
  - Added `restartMultiplayerGame()` method that properly leaves room before restart
  - Implemented automatic room rejoin after restart with `autoRejoinAfterRestart()`
  - Added comprehensive network entity cleanup before restart (`cleanupNetworkEntities()`)
  - Added registry-based state persistence across scene restarts
  - All players now properly see each other after any player restarts
  - Restart sequence: Leave Room → Clean Network State → Restart Scene → Auto-rejoin Room

- **BUG FIX**: Fixed critical sprite and physics body errors in network entity updates
  - Added comprehensive safety checks in `updateEnemiesFromServer`, `updateProjectilesFromServer`, and `updateNetworkPlayer`
  - Added try-catch blocks around sprite creation and updates to prevent crashes
  - Added sprite existence validation before calling setVelocity/setPosition methods
  - **NEW**: Added animation safety checks - validate sprite.anims exists before calling sprite.play()
  - **NEW**: Added physics body validation - check sprite.body exists before calling setVelocity()
  - **NEW**: Added automatic physics body recovery - attempt to enable physics if body is missing
  - **NEW**: Wrapped all animation code in try-catch blocks to prevent animation crashes
  - Improved error logging for better debugging of sprite creation, physics body, and animation failures
  - Network game now handles sprite creation, physics body, and animation failures gracefully without crashing

- **MAJOR MULTIPLAYER ARCHITECTURE REVISION**: Fixed hybrid client-server authority system
  - Restored client-side game state broadcasting for proper conflict resolution
  - Updated input action mapping to match server protocol (left/right/jump/shoot)
  - Implemented selective client reconciliation with higher thresholds for responsiveness
  - Added proper server state acceptance for enemies and projectiles
  - Modified broadcast throttle to 30fps for optimal conflict resolution
  - Enhanced network player management with server authority
  - Fixed client reconciliation to maintain local physics while accepting server corrections
  - Improved game state update handling for hybrid authority model

- **MAJOR FEATURE**: Implemented multiplayer rendering and synchronization
  - Added support for multiple player sprites in GameScene
  - Real-time player position updates from server game state
  - Network player rendering with visual differentiation (green tint)
  - Player ID tracking and local vs network player handling
  - Smooth position interpolation for network players
  - Automatic cleanup of disconnected players
- Fixed critical multiplayer bugs
  - Fixed player ID mismatch between server and client causing input issues
  - Fixed network player scaling (now matches local player size)
  - Fixed duplicate player rendering (local player appearing as network player)
  - Added proper single-player mode (no network players when alone)
  - Enhanced debugging and player state logging
  - Fixed timing issue: NetworkManager now stores player ID immediately on room_joined
  - Added fallback mechanisms to ensure player ID is available in GameScene
  - Fixed MenuScene DOM access error: Added null check for menuForm.node in connection status updates
- **MAJOR FIX**: Implemented server-authoritative physics to eliminate flickering
  - In multiplayer mode: Local player now follows server position exactly (no client physics)
  - Input system redesigned: Client only sends inputs to server, no local movement
  - Animation system updated: All animations driven by server state data
  - Offline mode preserved: Client physics still used when playing offline
  - Removed position threshold checks in multiplayer (server position is always correct)
- **NEW**: Added server-synchronized enemies for true multiplayer gaming
  - Multiplayer mode: Enemies managed by server, synchronized across all players
  - Offline mode: Enemies still created locally with client physics
  - Network enemies have visual differentiation (orange tint for owlets, pink for boss)
  - Server-side enemy AI with random movement and physics simulation
  - All players see the same enemy positions and movements in real-time
- **CRITICAL FIX**: Completely redesigned multiplayer input system
  - Fixed input flooding: Now only sends input on key state changes (not every frame)
  - Fixed character not stopping: Properly sends key release events (pressed=false)
  - Added input state tracking to prevent duplicate messages
  - Separated offline and multiplayer input handling for better reliability
  - Improved responsiveness and reduced server load significantly
- **MAJOR ARCHITECTURAL CHANGE**: Switched to client-side authoritative physics
  - **Why**: Server-side physics engine was causing sync issues, ground-level problems, and poor responsiveness
  - **Solution**: Use proven Phaser physics on client, server only relays state between players
  - **Benefits**: Immediate responsive controls, better collision detection, native shooting support
  - **Implementation**: Clients broadcast complete game state, server relays to other players
  - **Host System**: First player in room manages enemies/projectiles to prevent conflicts
  - **Collision Restoration**: Player-enemy and projectile-enemy collisions now work properly
  - **Shooting Fixed**: Local shooting with network projectile synchronization
- **CRITICAL TIMING FIX**: Fixed "Player not in any room" race condition
  - **Problem**: Clients started broadcasting game state before room join was fully confirmed
  - **Solution**: Added roomJoinConfirmed flag to prevent premature broadcasting
  - **Throttling**: Limited game state broadcasts to 10fps to reduce server load
  - **Confirmation**: Only broadcast after receiving room_joined confirmation or pre-confirmed player ID
  - **Result**: Eliminates NOT_IN_ROOM errors when joining/leaving rooms
- Changed keyboard controls: Space bar now shoots instead of jumping (up/w keys still handle jumping)
